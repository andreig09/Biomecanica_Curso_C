\section{Conclusiones}
%conclusiones, pendientes, etc

En esta sección se evaluarán las conclusiones obtenidas a partir de lo realizado en el proyecto. Las mismas se pueden separar en conclusiones generales, y en particulares de los capítulos vistos anteriormente.

Como conclusiones generales se presentan las siguientes:

INICIO DIVAGUE GONZALO

La aplicación desarrollada logra a partir de las capturas de múltiples vídeos de un sujeto en movimiento, detectar los marcadores en cada toma, junto a la información de las cámaras reconstruir la posición de los marcadores en el espacio , y poder identificar cada marcador a lo largo de la secuencia temporal.
\\ 

El relevo de bibliografía sobre el tema permitió observar los distintos enfoques del problema en distintos ámbitos, sus diferentes aplicaciones, y múltiples alternativas para solucionarlo, eligiendo un poco de cada lado para presentar nuestra propia solución, además de un conjunto propio de capturas sintéticas lo suficientemente ilustrativas para estudiar las nociones que se quisieron desarrollar, pero al mismo tiempo simples para poder generar múltiples conjuntos de datos en distintas situaciones. Sin embargo, esta simpleza no implica que nuestro conjunto de datos es completamente ideal, se modelan problemas que se van a encontrar en la realidad como la no visibilidad de marcadores en ciertas tomas y ciertos momentos.
\\ 

La detección de marcadores en tomas individuales es lograda mediante segmentación, y con el apoyo de la extracción de fondo, presenta poco error para calcular los centros de los marcadores y se considera exitosa para el caso sintético y funcional en el caso real. El ajuste de los parámetros internos a la segmentación permite variar los resultados para poder descartar figuras extrañas a los marcadores que queremos detectar
\\ 

El bloque de calibración de las cámaras es tan variable como las cámaras que se pretenden utilizar, pero se presenta una metodología propia si bien distinta a los casos observados para poder obtener los parámetros intrínsecos y extrínsecos de las cámaras del laboratorio de captura. Esta información es correctamente relevada , y permite medir como están relacionados los puntos en dos o mas vistas, lo cual es el corazón de la reconstrucción. Con esta información del espacio de captura, y los puntos segmentados en las múltiples vistas, los resultados del pasaje al espacio que logra el bloque en reconstrucción está  fuertemente atado al volumen de información que viene de las cámaras. La reconstrucción permite generar los puntos en el espacio siempre que se tenga información para emparejar puntos en dos vistas y confirmar  la relación. En las condiciones aceptables, la reconstruccion cumple con su cometido de generar los puntos con errores del orden del centímetro, lo cual se considera aceptable para un sistema de captura de movimiento. La dificultad de tener una calibración distinta a la propuesta, y pocas cámaras con las cuales trabajar, no permitió un estudio profundo en el caso real proporcionado por Darío Santos,(Hospital de Clínicas), obtenidas cuando el proyecto ya estaba muy avanzado. Sin embargo, se trabajó en una implementacion que tuviera en cuenta las restricciones del caso real, la cual no pudo ser probada exhaustivamente.
\\ 

Con los puntos generados en el espacio para todos los instantes de la secuencia, solo queda seguir e identificar las trayectorias de cada uno de los marcadores. Para esto se implemento un algoritmo de seguimiento basado en restricciones de velocidad y trayectorias, basada en la hipótesis de correcto muestreo de la secuencia , y que la reconstrucción logro reconstruir puntos en la mayoría de los casos. Si las perdidas son puntuales y no se mantienen en el tiempo, hay implementadas medidas para recuperar trayectorias de forma de continuar el movimiento. Los resultados de performance de seguimiento son los mismos que los de reconstruccion, pero se puede medir los errores de forma mas fina, teniendo para cada marcador el mismo buen rendimiento que para el conjunto entero, y toda posible discontinuidad puede ser detectada y reparada para forzar la continuidad. 
\\ 

Al no estar implementada la re-alimentación entre bloques que proponía Lorna Herda, se pudo desarrollar los bloques de forma independiente pero no se pudo medir si hubiera mejorado los resultados, sobretodo en el caso real que faltó probar, por no disponer de datos que cumplieran las hipótesis, no haberlos podido generar nosotros mismos ,o cuando nos fueron proporcionados se dispuso de poco tiempo para procesarlos.
\\

El proyecto tardó en comenzar a definir todo lo aquí presentado en este documento, la búsqueda de bibliografía y de un sistema que presentara de forma comprensible el problema con nuestros conocimientos al momento de comenzar, se tomó más tiempo de lo estimado, y cuando se comenzó a implementar el sistema se encontraron algunos problemas puntuales que necesitaron de la atención de todos los miembros del grupo para poder ser solucionados. La prorroga solicitada de 2 meses fue utilizada para terminar de solucionar los problemas, y se comenzó a documentar los resultados finales solo cuando todas las partes del sistema lograron funcionar. Con estos problemas puntuales solucionados, se logró concluir con los objetivos de comprender el sistema y presentar los distintos pasos para poder obtener resultados que muestran que la comprensión e interpretación de todo aquello que se relevo fue correcta.

(HABLAR ALGO DE POSIBLES MEJORAS)

FIN DIVAGUE GONZALO


\begin{itemize}
\item Se cumplió el objetivo principal: se logró obtener un sistema completo que a partir de las capturas de video de una persona en un ambiente de laboratorio con las condiciones adecuadas, obtiene la posición 3D de  los marcadores presentes en el cuerpo de dicha persona, logrando representar su movimiento con una precisión del orden del centímetro. El sistema completo se encuentra publicado en un repositorio de Github\footnote{https://github.com/} y se puede acceder a él mediante el siguiente link: \emph{https://github.com/andreig09/Proyecto\_Biomecanica.git}.
\item Se logró relevar la literatura existente, y se realizó una clasificación de los documentos de acuerdo a la relevancia que prestan para construir un sistema de estas características. 
\item Se relevó el software existente, y se buscaron implementaciones en matlab, C/C++ y otros lenguajes, pero no se encontró un software Open Source que se adaptara a las características necesarias para utilizar de base en este proyecto. Debido a esto, se decidió implementar los bloques por cuenta propia, utilizando algunos algoritmos básicos de procesamiento de imágenes ya implementados o realizados específicamente para este proyecto. Esta etapa por momentos tuvo un carácter más de investigación científica que de proyecto ingenieril.
\item Se identificaron los distintos casos de uso, y se decidió implementar el sistema en base al caso de uso de marcha.
\item Se lograron implementar los 4 grupos de algoritmos principales que componen la aplicación: calibración, detección de marcadores, estimación de pose (o reconstrucción) y seguimiento.
\item Se generó un sistema que integra los 4 bloques nombrados en el punto anterior, y que dada la entrada definida obtiene la salida esperada.
\item Se elaboró una interfaz gráfica de usuario (GUI) básica para que el sistema pueda ser utilizado de una forma más práctica y amigable por el usuario.
\item Se buscaron bases de datos que se encuentren dentro de las hipótesis del problema, de forma tal de probar el mismo para diferentes casos y evaluar su rendimiento. Debido a que no se encontró ninguna base de datos disponible que cumpla con las características deseadas, se elaboró una en base a secuencias sintéticas generadas en Blender.
\item Se generó un conjunto de benchmarks\footnote{Herramientas de evaluación de performance.}, capaces de obtener una buena medida del rendimiento del sistema. 
\end{itemize}

A continuación, se plantean las conclusiones específicas de las etapas principales del proyecto:
\begin{itemize}
	\item Relevamiento bibliográfico
	\begin{itemize}
		\item No se encontraron implementaciones de sistemas de captura de movimiento Open Source con las características del sistema de este proyecto. 
	\end{itemize}
	\item Base de datos
	\item Calibración
	\item Detección de marcadores
	\begin{itemize}
		\item Se logró implementar un conjunto de algoritmos capaces de detectar la posición 2D de los marcadores en el cuerpo del paciente para todo instante de tiempo y exponer los resultados en un archivo XML. 
		\item Los resultados correspondientes a las pruebas con secuencias sintéticas fueron muy buenos, logrando un error que en la mayoría de los casos se ubicó por debajo de los 4 píxeles.
		\item Por el lado del procesamiento de secuencias reales, no se consiguieron secuencias que estén exactamente en las hipótesis del problema. Aún así, se realizaron pruebas con secuencias que se asemejaban a las condiciones necesarias obteniendo buenos resultados al extraer el fondo de la captura.
		\item Se observó que para ambientes donde las condiciones se mantienen constantes a lo largo del tiempo (como por ejemplo en un laboratorio), el umbral no cambia significativamente su valor, pudiéndose utilizar un valor constante en el para toda una secuencia. Esto permite ahorrar tiempo de procesamiento y reduce el costo computacional de la detección.
		\item Se observó que se puede mejorar la detección, ajustando los valores de las constantes $A$ y $B$ del filtro circular (ver sección \ref{implementSegment}) de forma tal de hacer el filtro más selectivo o menos.
	\end{itemize}
	\item Reconstrucción
	\item Seguimiento
	
	\begin{itemize}
	
	\item Los puntos reconstruidos en la reconstrucción son correctamente identificados y etiquetados en trayectorias, mediante la implementacion de un algoritmo simple de seguimiento combinando búsqueda de marcadores mas próximos con una estimación lineal determinada por la información previa de trayectoria	hasta el momento.
	
	\item Las perdidas de marcadores en pocos frames son detectadas, y estimadas al recuperar la trayectoria mediante predicciones lineales y radiales. Los marcadores recuperados cumplen las ecuaciones de continuidad de velocidad y aceleración.
	
	\item Las trayectorias obtenidas son evaluadas para encontrar grandes saltos en aceleración, detectar marcadores a corregir, e implementando correcciones que cumplan las hipótesis establecidas en el movimiento.
	
	\end{itemize}		
	
	\item Medida de performance
	\begin{itemize}
		\item Se obtuvo una precisión en la detección de los marcadores, con errores del orden centímetro.
		\item El máximo error por marcador no superó los 5 cm.
		\item Se obtuvieron muy buenos resultados, logrando reconstruir todos los marcadores en toda la secuencia hasta con un mínimo de 6 cámaras. Con menos cámaras se pierden marcadores ocasionalmente.
		\item Para el caso de 6 cámaras, la correcta detección del movimiento depende de la posición y la disposición entre ellas que tengan en el espacio.
	\end{itemize}
\end{itemize}

Por temas de cronograma y de presupuesto, en muchos aspectos no se utilizó la tecnología más moderna (por ejemplo sensores infrarrojos, cámaras de mejor calidad, etc.) que de haberlas utilizado se hubiesen logrado mejores resultados. Si bien esta primera versión del sistema no está a la altura de los sistemas comerciales vistos en este documento, se logró dar el primer paso y se dejaron todas las condiciones necesarias para poder continuar con el proyecto y llevar el mismo al nivel de las otras herramientas.

Quedan como tareas pendientes para etapas futuras:
\begin{itemize}
	\item Probar el sistema en un laboratorio con las características definidas en este proyecto y con 6 o más cámaras previamente calibradas.
	\item Adaptar el sistema para otros casos de uso además de la marcha.
	\item Robustecer la segmentación, ya sea agregando algoritmos que complementen la umbralización de Otsu\cite{otsu} o cambiando la umbralización por un algoritmo más complejo.
	
	\item Implementar un algoritmo alternativo de reconstrucción que funcione de forma mas robusta para el caso real
	
	\item Probar otros algoritmos de seguimiento de marcadores, e implementar restricciones de esqueleto y movimiento angular
	
	\item Establecer la realimentacion entre el bloque de reconstrucción y seguimiento para robustecer ambos bloques 	
	
	\item Mejorar la interfaz gráfica de usuario, haciéndola más amigable e intuitiva, de forma tal que el especialista pueda utilizarla como una aplicación de usuario.
	\item Realizar un manual de usuario.
\end{itemize}